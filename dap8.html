<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>DAP8 - Wave Check</title>
    <link rel="stylesheet" href="style.css?v=20250910071128">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
</head>
<body>
    <header class="site-header">
        <a href="index.html" id="adminBtn" class="admin-button-link">Admin</a>
        <a href="index.html">
            <img loading="lazy" src="https://www.franchiseverband.com/typo3temp/assets/_processed_/b/c/csm_Logo_Amazon_78ff002b7a.png" alt="Amazon Logo" class="amazon-logo">
        </a>
        <img loading="lazy" src="dap8-logo.png" alt="DAP8 Logo" class="dap8-logo">
    </header>

    <main class="station-page-wrapper" data-station-id="DAP8">
        <h1 class="station-title">Wave Check: DAP8 (Premst√§tten)</h1>
        <nav class="tab-nav">
            <a href="#wave-check" class="tab-link active" data-tab="wave-check-content">Wave Check</a>
            <a href="#caproster" class="tab-link" data-tab="caproster-content">CapRoster</a>
            <a href="#dashboard" class="tab-link" data-tab="dashboard-content">Dashboard</a>
            <a href="#da-list" class="tab-link" data-tab="da-list-content">DA-List</a>
        </nav>
        <div class="tab-content-container">
            <div id="wave-check-content" class="tab-pane active">
                <h3>Badge Scan</h3>
                <form id="wave-check-form" class="scanner-area">
                    <div id="scanner-output" class="scanner-placeholder"><p>Scan a driver's Badge ID to begin.</p></div>
                    <input type="text" class="manual-badge-input" placeholder="Or enter badge ID manually...">
                    <button type="submit" class="scan-button">Submit</button>
                </form>
            </div>
            <div id="caproster-content" class="tab-pane">
                <div class="roster-actions">
                    <div class="roster-form">
                        <h4>Add Single Driver to Roster</h4>
                        <form id="add-roster-form" class="add-driver-form">
                            <div class="form-field"><label for="roster-badgeId">Badge ID</label><input id="roster-badgeId" type="text" name="badgeId" required></div>
                            <div class="form-field"><label for="roster-name">Name</label><input id="roster-name" type="text" name="name" required></div>
                            <div class="form-field"><label for="roster-startTime">Start Time</label><input id="roster-startTime" type="text" name="startTime" required></div>
                            <div class="form-field"><label for="roster-firmenname">Company Name</label><input id="roster-firmenname" type="text" name="firmenname" required></div>
                            <button type="submit" class="form-full-width-btn">Add to Roster</button>
                        </form>
                    </div>
                    <div class="roster-form">
                        <h4>Create/Overwrite Roster in Bulk</h4>
                        <form class="bulk-roster-form">
                            <textarea placeholder="Paste roster list from a spreadsheet..."></textarea>
                            <div class="bulk-buttons">
                                <button type="submit" class="btn-process">Process Roster</button>
                                <button type="button" id="reset-roster-btn" class="btn-reset">Reset Roster</button>
                            </div>
                        </form>
                    </div>
                </div>
                <h3>Today's Roster</h3>
                <table class="data-table" id="drivers-table">
                    <thead>
                        <tr>
                            <th>Transporter ID</th>
                            <th>Badge ID</th>
                            <th>Name</th>
                            <th>Start Time</th>
                            <th>Firmenname</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="roster-table-body"></tbody>
                </table>
            </div>
            <div id="dashboard-content" class="tab-pane">
                <h3>Live Dashboard</h3>
                <div class="dashboard-grid">
                    <div class="stat-card"><h4>Total on Roster</h4><p id="total-drivers">0</p></div>
                    <div class="stat-card"><h4>Checked In</h4><p id="checked-in-drivers">0</p></div>
                    <div class="stat-card"><h4>Remaining</h4><p id="remaining-drivers">0</p></div>
                    <div class="stat-card"><h4>On Rescue</h4><p id="rescue-drivers">0</p></div>
                </div>
            </div>
            <div id="da-list-content" class="tab-pane">
                <div class="roster-actions">
                    <div class="roster-form">
                        <h4>Add Single Driver to Database</h4>
                        <form id="add-da-form">
                            <div class="form-field"><label for="da-userId">User ID</label><input type="text" id="da-userId" name="userId" required></div>
                            <div class="form-field"><label for="da-name">Employee Name</label><input type="text" id="da-name" name="name" required></div>
                            <div class="form-field"><label for="da-badgeId">Badge ID</label><input type="text" id="da-badgeId" name="badgeId" required></div>
                            <div class="form-field"><label for="da-companyName">Company Name</label><input type="text" id="da-companyName" name="companyName" required></div>
                            <div class="form-field"><label for="da-transporterId">Transporter ID</label><input type="text" id="da-transporterId" name="transporterId" required></div>
                            <button type="submit" class="form-full-width-btn">Save to Database</button>
                        </form>
                    </div>
                </div>
                <h3>Master Driver Database (DA-List)</h3>
                <table class="data-table">
                    <thead><tr><th>User ID</th><th>Employee Name</th><th>Badge ID</th><th>Company Name</th><th>Transporter ID</th><th>Actions</th></tr></thead>
                    <tbody id="da-list-table-body"></tbody>
                </table>
            </div>
        </div>
    </main>
    <footer class="site-footer"><p>&copy; 2025 Developed & Coded by Karim Elbeih Badawy (DAP8)</p></footer>

    <script type="module" src="script.js?v=20250910071128"></script>

    <!-- Added: Wave page roster responder -->
    <script>
    (function(){
      function norm(s){ return (s||'').replace(/\s+/g,' ').trim(); }
      function getNames() {
        var table = document.querySelector('#drivers-table') || document.querySelector('table.data-table');
        if (table) {
          var rows = Array.from(table.querySelectorAll('tbody tr'));
          if (!rows.length) rows = Array.from(table.querySelectorAll('tr')).slice(1);
          var nameIdx = 2; // Name column index
          var names = rows.map(tr => {
            var cells = Array.from(tr.querySelectorAll('td,th'));
            var c = cells[nameIdx] || cells[0];
            return norm(c ? c.textContent : '');
          }).filter(Boolean);
          if (names.length) return names;
        }
        return [];
      }
      window.addEventListener('message', ev => {
        var msg = ev.data;
        if (!msg || typeof msg !== 'object') return;
        if (msg.type === 'REQUEST_WAVE_ROSTER') {
          var names = getNames();
          try {
            ev.source && ev.source.postMessage({ type:'WAVE_PAGE_ROSTER', names: names }, ev.origin || '*');
          } catch(e) {
            try { ev.source && ev.source.postMessage({ type:'WAVE_PAGE_ROSTER', names: names }, '*'); } catch(e2){}
          }
        }
      });
      window.__waveGetNames = getNames;
    })();
    </script>

</body>
</html>
